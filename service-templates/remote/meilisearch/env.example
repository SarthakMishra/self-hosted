# Meilisearch Environment Configuration
# Copy this file to .env and customize for your installation

# ==============================================
# DOMAIN CONFIGURATION
# ==============================================

# The domain where Meilisearch will be accessible
# Example: search.yourdomain.com
MEILISEARCH_DOMAIN=search.example.com

# ==============================================
# SECURITY CONFIGURATION
# ==============================================

# Master key for API authentication (REQUIRED)
# Generate a secure key: openssl rand -hex 32
# This key is required to access the Meilisearch API
# Keep this key secure and never commit it to version control
MEILI_MASTER_KEY=your_secure_master_key_here

# Environment mode: development or production
# production: optimized for performance, minimal logging
# development: more verbose logging, useful for debugging
MEILI_ENV=production

# ==============================================
# DATABASE CONFIGURATION
# ==============================================

# Database path (default: /meili_data)
# Only change if you need a custom path
# MEILI_DB_PATH=/meili_data

# ==============================================
# NETWORK CONFIGURATION
# ==============================================

# HTTP address and port (default: 0.0.0.0:7700)
# Only change if you need a custom address/port
# MEILI_HTTP_ADDR=0.0.0.0:7700

# ==============================================
# PERFORMANCE CONFIGURATION (OPTIONAL)
# ==============================================

# Maximum indexing memory in bytes
# Example: 2147483648 for 2GB
# Leave empty to use default (2GB)
# MEILI_MAX_INDEXING_MEMORY=

# Maximum number of indexing threads
# Leave empty to use default (number of CPU cores)
# MEILI_MAX_INDEXING_THREADS=

# ==============================================
# LOGGING CONFIGURATION (OPTIONAL)
# ==============================================

# Log level: DEBUG, INFO, WARN, ERROR
# Default: INFO
# MEILI_LOG_LEVEL=INFO

# ==============================================
# ANALYTICS CONFIGURATION (OPTIONAL)
# ==============================================

# Disable analytics (set to true to disable)
# Default: false
# MEILI_NO_ANALYTICS=false

# ==============================================
# SSL CONFIGURATION (OPTIONAL)
# ==============================================

# SSL authentication and certificate paths
# Only needed if using SSL/TLS directly (Traefik handles SSL in this setup)
# MEILI_SSL_AUTH_PATH=
# MEILI_SSL_CERT_PATH=
# MEILI_SSL_KEY_PATH=
# MEILI_SSL_OCSP_PATH=
# MEILI_SSL_RESUMPTION=
# MEILI_SSL_TICKETS=

# ==============================================
# EXAMPLE CONFIGURATIONS
# ==============================================

# Basic production setup:
# MEILISEARCH_DOMAIN=search.yourdomain.com
# MEILI_MASTER_KEY=generated_secure_key_here
# MEILI_ENV=production

# Development setup with verbose logging:
# MEILISEARCH_DOMAIN=search.dev.local
# MEILI_MASTER_KEY=dev_key_here
# MEILI_ENV=development
# MEILI_LOG_LEVEL=DEBUG

# High-performance setup with custom memory limits:
# MEILISEARCH_DOMAIN=search.yourdomain.com
# MEILI_MASTER_KEY=generated_secure_key_here
# MEILI_ENV=production
# MEILI_MAX_INDEXING_MEMORY=4294967296
# MEILI_MAX_INDEXING_THREADS=8

# ==============================================
# ROUTING CONFIGURATION
# ==============================================

# Meilisearch uses a single router for search endpoints:
# - Search Router: GET requests only, with CORS enabled
#   - Handles: /indexes/{index}/search (GET), /health (GET)
#   - No API key required for search endpoints
#   - Accessible via Traefik at https://your-domain.com
#
# Admin endpoints are accessed directly via Tailscale:
# - Admin access: All HTTP methods, requires MEILI_MASTER_KEY
#   - Handles: /keys, /tasks, /indexes (POST/PUT/DELETE), /version, /stats, /dumps
#   - Access directly via Tailscale on port 7700
#   - Use MEILI_MASTER_KEY for authentication

# ==============================================
# CORS CONFIGURATION
# ==============================================

# CORS (Cross-Origin Resource Sharing) is configured in Traefik middlewares.yml
# To allow your frontend to access Meilisearch search endpoints:
# 1. Edit service-templates/remote/traefik/middlewares.yml
# 2. Find the "meilisearch-cors" middleware
# 3. Update "accessControlAllowOriginList" with your frontend domain(s)
# 4. Example: - "https://your-frontend-domain.com"
# 5. Restart Traefik: docker compose restart traefik

# ==============================================
# FIRST-TIME SETUP
# ==============================================

# 1. Set your domain and generate a secure master key
#    Generate key: openssl rand -hex 32
# 2. Copy this file to .env: cp env.example .env
# 3. Edit .env and set your values
# 4. Deploy with: docker compose up -d
# 5. Visit https://your-domain.com to access Meilisearch
# 6. Use the master key to authenticate API requests
# 7. Check health: curl https://your-domain.com/health

# ==============================================
# API USAGE
# ==============================================

# Search endpoints (via Traefik - no API key required):
# curl 'https://your-domain.com/indexes/movies/search?q=example'

# Admin endpoints (via Tailscale - requires MEILI_MASTER_KEY):
# Access via Tailscale IP:port 7700
# Example: Create an index
# curl -X POST 'http://meilisearch-host:7700/indexes' \
#   -H 'X-Meili-API-Key: your_master_key_here' \
#   -H 'Content-Type: application/json' \
#   --data-binary '{ "uid": "movies", "primaryKey": "id" }'

# Example: Add documents
# curl -X POST 'http://meilisearch-host:7700/indexes/movies/documents' \
#   -H 'X-Meili-API-Key: your_master_key_here' \
#   -H 'Content-Type: application/json' \
#   --data-binary '[{ "id": 1, "title": "Example Movie" }]'
