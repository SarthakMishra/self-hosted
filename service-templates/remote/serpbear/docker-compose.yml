services:
  serpbear:
    image: towfiqi/serpbear:latest
    container_name: serpbear
    restart: unless-stopped

    # Environment configuration
    env_file:
      - .env

    environment:
      # Core SerpBear configuration
      - USER=${SERPBEAR_USER:-admin}
      - PASSWORD=${SERPBEAR_PASSWORD}
      - SECRET=${SERPBEAR_SECRET}
      - APIKEY=${SERPBEAR_APIKEY}
      - NEXT_PUBLIC_APP_URL=https://${SERPBEAR_DOMAIN}

      # Optional: Additional configuration
      - NODE_ENV=${NODE_ENV:-production}
      - PORT=3000
      - SEARCH_CONSOLE_CLIENT_EMAIL=${SEARCH_CONSOLE_CLIENT_EMAIL}
      - SEARCH_CONSOLE_PRIVATE_KEY=${SEARCH_CONSOLE_PRIVATE_KEY}
      - ADWORDS_CLIENT_ID=${ADWORDS_CLIENT_ID}
      - ADWORDS_CLIENT_SECRET=${ADWORDS_CLIENT_SECRET}

      # SMTP configuration
      - SMTP_SERVER=${SMTP_SERVER}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USERNAME=${SMTP_USERNAME}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - NOTIFICATION_EMAIL_FROM=${NOTIFICATION_EMAIL_FROM}

    volumes:
      # Persistent data storage
      - serpbear_data:/app/data

    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.serpbear.rule=Host(`${SERPBEAR_DOMAIN}`)"
      - "traefik.http.routers.serpbear.entrypoints=websecure"
      - "traefik.http.routers.serpbear.tls.certresolver=letsencrypt"
      - "traefik.http.routers.serpbear.service=serpbear"
      - "traefik.http.services.serpbear.loadbalancer.server.port=3000"
      - "traefik.http.routers.serpbear.middlewares=security-headers@file,crowdsec@file"

      - "com.centurylinklabs.watchtower.enable=true"

    # Network configuration
    networks:
      - app-network

# External network created by Traefik
networks:
  app-network:
    external: true

# Persistent volumes
volumes:
  serpbear_data:
    driver: local
