# {{ ansible_managed }}
# CrowdSec Firewall Bouncer Configuration
# Generated by Ansible crowdsec role

mode: {{ crowdsec_bouncer_mode }}
update_frequency: {{ crowdsec_bouncer_update_frequency }}
log_mode: {{ crowdsec_bouncer_log_mode }}
log_dir: {{ crowdsec_bouncer_log_dir }}
log_level: {{ crowdsec_bouncer_log_level }}
log_compression: {{ crowdsec_bouncer_log_compression | lower }}
log_max_size: {{ crowdsec_bouncer_log_max_size }}
log_max_backups: {{ crowdsec_bouncer_log_max_backups }}
log_max_age: {{ crowdsec_bouncer_log_max_age }}

# CrowdSec API Configuration
api_url: {{ crowdsec_api_url }}
api_key: {{ crowdsec_api_key }}

# TLS Authentication (disabled by default)
# cert_path: /etc/crowdsec/tls/cert.pem
# key_path: /etc/crowdsec/tls/key.pem
# ca_cert_path: /etc/crowdsec/tls/ca.crt
insecure_skip_verify: {{ crowdsec_insecure_skip_verify | lower }}

# Network Configuration
disable_ipv6: {{ crowdsec_disable_ipv6 | lower }}

# Firewall Actions
deny_action: {{ crowdsec_deny_action }}
deny_log: {{ crowdsec_deny_log | lower }}
{% if crowdsec_deny_log_prefix is defined %}
deny_log_prefix: "{{ crowdsec_deny_log_prefix }}"
{% endif %}

# Decision Types
supported_decisions_types:
{% for decision_type in crowdsec_supported_decisions_types %}
  - {{ decision_type }}
{% endfor %}

# IPSet Configuration
blacklists_ipv4: {{ crowdsec_blacklists_ipv4 }}
blacklists_ipv6: {{ crowdsec_blacklists_ipv6 }}
ipset_type: {{ crowdsec_ipset_type }}

# IPTables Configuration - UFW and Docker Integration
iptables_chains:
{% for chain in crowdsec_iptables_chains %}
  - {{ chain }}
{% endfor %}
iptables_add_rule_comments: {{ crowdsec_iptables_add_rule_comments | lower }}

# NFTables Configuration (not used with UFW but available)
nftables:
  ipv4:
    enabled: {{ crowdsec_nftables_ipv4_enabled | lower }}
    set-only: {{ crowdsec_nftables_ipv4_set_only | lower }}
    table: {{ crowdsec_nftables_ipv4_table }}
    chain: {{ crowdsec_nftables_ipv4_chain }}
    priority: {{ crowdsec_nftables_ipv4_priority }}
  ipv6:
    enabled: {{ crowdsec_nftables_ipv6_enabled | lower }}
    set-only: {{ crowdsec_nftables_ipv6_set_only | lower }}
    table: {{ crowdsec_nftables_ipv6_table }}
    chain: {{ crowdsec_nftables_ipv6_chain }}
    priority: {{ crowdsec_nftables_ipv6_priority }}

nftables_hooks:
{% for hook in crowdsec_nftables_hooks %}
  - {{ hook }}
{% endfor %}

# Packet Filter (for BSD systems - disabled for Linux)
pf:
  anchor_name: ""

# Prometheus Metrics (optional)
prometheus:
  enabled: {{ crowdsec_prometheus_enabled | lower }}
  listen_addr: {{ crowdsec_prometheus_listen_addr }}
  listen_port: {{ crowdsec_prometheus_listen_port }} 